{% extends "base.html" %}
{% block content %}
<h1 class="text-2xl font-semibold mb-4">Profilo</h1>

<form method="post" action="/profile" enctype="multipart/form-data" class="grid md:grid-cols-2 gap-6" onsubmit="showOverlay()">
  <div class="space-y-3">
    <label class="block">
      <span class="text-sm font-medium">Nome</span>
      <input name="first_name" class="w-full border rounded p-2" value="{{ (profile or {}).get('first_name','') }}">
    </label>
    <label class="block">
      <span class="text-sm font-medium">Cognome</span>
      <input name="last_name" class="w-full border rounded p-2" value="{{ (profile or {}).get('last_name','') }}">
    </label>
    <label class="block">
      <span class="text-sm font-medium">Ruolo</span>
      <input name="role" class="w-full border rounded p-2" value="{{ (profile or {}).get('role','') }}">
    </label>
    <label class="block">
      <span class="text-sm font-medium">Ente</span>
      <input name="ente" class="w-full border rounded p-2" value="{{ (profile or {}).get('ente','') }}">
    </label>

    <fieldset class="border rounded p-3">
      <legend class="text-sm font-medium">Toni</legend>
      {% set sel = (profile or {}).get('tones',[]) %}
      {% for t in [
        "istituzionale","empatico","determinato","pragmatico","inclusivo","vicino alla popolazione",
        "pro-impresa","ambientalista","riformista","trasparente","coraggioso","pacato","energico","concreto","visionario"
      ] %}
      <label class="block"><input type="checkbox" name="tones" value="{{ t }}" {% if t in sel %}checked{% endif %}> {{ t }}</label>
      {% endfor %}
      <label class="block mt-2">
        <span class="text-sm">Altro</span>
        <input name="tone_other" class="w-full border rounded p-2" placeholder="es. vorrei scrivessi come un sindaco vicino alla popolazione" value="{{ (profile or {}).get('tone_other','') }}">
      </label>
    </fieldset>

    <fieldset class="border rounded p-3">
      <legend class="text-sm font-medium">Canali</legend>
      {% set ch = (profile or {}).get('channels',["Social"]) %}
      {% for c in ["Social","Sito","Stampa"] %}
      <label class="block"><input type="checkbox" name="channels" value="{{ c }}" {% if c in ch %}checked{% endif %}> {{ c }}</label>
      {% endfor %}
    </fieldset>

    <div class="flex items-center gap-3">
      {% if (profile or {}).get('photo_path') %}
        <img src="/static/userpic.png" onerror="this.src='/static/userpic.png'" alt="" class="w-12 h-12 rounded-full border">
      {% endif %}
      <label class="block">
        <span class="text-sm font-medium">Foto profilo (PNG/JPG)</span>
        <input type="file" name="photo" accept="image/*">
      </label>
    </div>

    <label class="inline-flex items-center gap-2 mt-2">
      <input type="checkbox" name="try_header">
      <span>Prova a impostare un banner automatico dall'Ente (Wikipedia)</span>
    </label>

    <button class="mt-3 px-4 py-2 bg-primary text-white rounded" style="background:var(--primary)">Salva</button>
  </div>

  <div>
    {% if (profile or {}).get('header_image_url') %}
      <div class="text-sm mb-2">Header attuale</div>
      <img src="{{ (profile or {}).get('header_image_url') }}" alt="" class="w-full h-40 object-cover rounded border">
    {% endif %}
  </div>
</form>
{% endblock %}

