<!doctype html>
<html lang="it" class="h-full bg-gray-50">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>{{ app_name }} ‚Ä¢ VoxUp</title>
  <meta name="color-scheme" content="light only">
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <link rel="icon" href="https://fav.farm/üéôÔ∏è">
  <style>
    .overlay { position: fixed; inset: 0; background: rgba(0,0,0,.45); display: none; align-items: center; justify-content: center; z-index: 60; }
    .overlay.show { display: flex; }
    .sr-only-focusable:focus { position: static; width: auto; height: auto; margin: 0; overflow: visible; clip: auto; }
  </style>
</head>
<body class="h-full text-gray-900">
  <a href="#main" class="sr-only sr-only-focusable focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-600">
    Salta al contenuto
  </a>

  <div class="min-h-full">
    <div class="grid grid-cols-12 gap-0">
      <aside class="col-span-12 md:col-span-3 lg:col-span-2 bg-white border-r border-gray-200">
        <div class="p-4">
          <div class="flex items-center gap-2">
            <span class="text-2xl">üéôÔ∏è</span>
            <div>
              <div class="font-bold text-lg">{{ app_name }}</div>
              <div class="text-xs text-gray-500">Ufficio stampa politico</div>
            </div>
          </div>

          {% set path = request.url.path %}
          <nav class="mt-6 space-y-1">
            {% if request.session.get('auth') %}
              <a href="/" class="block px-3 py-2 rounded-lg font-medium {% if path=='/' %}bg-indigo-50 text-indigo-700{% else %}text-gray-700 hover:bg-gray-100{% endif %}">Onboarding</a>
              <a href="/compose" class="block px-3 py-2 rounded-lg font-medium {% if path.startswith('/compose') %}bg-indigo-50 text-indigo-700{% else %}text-gray-700 hover:bg-gray-100{% endif %}">Upload & Genera</a>
              <a href="/style" class="block px-3 py-2 rounded-lg font-medium {% if path.startswith('/style') %}bg-indigo-50 text-indigo-700{% else %}text-gray-700 hover:bg-gray-100{% endif %}">Stile</a>
              <a href="/profile" class="block px-3 py-2 rounded-lg font-medium {% if path.startswith('/profile') %}bg-indigo-50 text-indigo-700{% else %}text-gray-700 hover:bg-gray-100{% endif %}">Profilo</a>
              <a href="/drafts" class="block px-3 py-2 rounded-lg font-medium {% if path.startswith('/drafts') %}bg-indigo-50 text-indigo-700{% else %}text-gray-700 hover:bg-gray-100{% endif %}">Bozze</a>
            {% else %}
              <a href="/login" class="block px-3 py-2 rounded-lg font-medium {% if path.startswith('/login') %}bg-indigo-50 text-indigo-700{% else %}text-gray-700 hover:bg-gray-100{% endif %}">Login</a>
              <a href="/register" class="block px-3 py-2 rounded-lg font-medium {% if path.startswith('/register') %}bg-indigo-50 text-indigo-700{% else %}text-gray-700 hover:bg-gray-100{% endif %}">Registrati</a>
            {% endif %}
          </nav>
        </div>

        <div class="px-4 py-4 border-t border-gray-200 flex items-center justify-between">
          {% if request.session.get('auth') %}
            {% set u = (request.session.get('user') or {}) %}
            <div class="text-sm text-gray-600 truncate">üë§ {{ u.get('name','') }}</div>
            <a href="/logout" class="text-sm text-gray-600 hover:text-gray-900">Esci</a>
          {% else %}
            <span class="text-xs text-gray-400">Non autenticato</span>
          {% endif %}
          <span class="text-xs text-gray-400">v0.3</span>
        </div>
      </aside>

      <main id="main" class="col-span-12 md:col-span-9 lg:col-span-10">
        <div class="max-w-5xl mx-auto p-4 md:p-8">
          {% block content %}{% endblock %}
        </div>
      </main>
    </div>
  </div>

  <div id="overlay" class="overlay" role="alert" aria-live="assertive" aria-busy="true">
    <div class="bg-white rounded-xl p-6 shadow-xl text-center">
      <svg class="animate-spin mx-auto h-10 w-10" viewBox="0 0 24 24">
        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none" opacity="0.25"></circle>
        <path d="M4 12a8 8 0 018-8" stroke="currentColor" stroke-width="4"></path>
      </svg>
      <p class="mt-3 font-medium">Elaborazione in corso‚Ä¶</p>
    </div>
  </div>

  <script>
    function showOverlay(){ document.getElementById('overlay').classList.add('show'); }
    // Accessibilit√†: preferenza dimensione testo locale
    const htmlEl = document.documentElement;
    const saved = localStorage.getItem('voxup-fontsize');
    if (saved) htmlEl.style.fontSize = saved;
    addEventListener('DOMContentLoaded', () => {
      const dec = document.getElementById('font-dec');
      const inc = document.getElementById('font-inc');
      function set(size){ htmlEl.style.fontSize = size; localStorage.setItem('voxup-fontsize', size); }
      if (dec) dec.addEventListener('click', () => set('15px'));
      if (inc) inc.addEventListener('click', () => set('18px'));
    });
  </script>
</body>
</html>
